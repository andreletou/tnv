{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Confirmation de Commande - Marketplace{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <button onclick="history.back()" class="p-2 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-arrow-left text-gray-600"></i>
                    </button>
                    <h1 class="text-lg font-semibold text-gray-900">Confirmation</h1>
                </div>
            </div>
        </div>
    </header>

    <!-- Success Message -->
    <div class="px-4 py-6">
        <div class="bg-white rounded-lg p-6 text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            
            <h2 class="text-xl font-bold text-gray-900 mb-2">Commande Confirmée !</h2>
            <p class="text-gray-600 mb-4">
                Votre commande <strong>{{ commande.reference }}</strong> a été passée avec succès.
            </p>
            
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Total payé:</span>
                    <span class="text-xl font-bold text-primary-600">{{ commande.total|format_currency }}</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-600">Méthode de paiement:</span>
                    <span class="font-medium">{{ commande.get_methode_paiement_display }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Details -->
    <div class="px-4 py-4">
        <div class="bg-white rounded-lg p-4">
            <h3 class="font-semibold text-gray-900 mb-4">Détails de la commande</h3>
            
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Référence:</span>
                    <span class="font-medium">{{ commande.reference }}</span>
                </div>
                
                <div class="flex justify-between">
                    <span class="text-gray-600">Date:</span>
                    <span class="font-medium">{{ commande.date_commande|date:"d/m/Y H:i" }}</span>
                </div>
                
                <div class="flex justify-between">
                    <span class="text-gray-600">Statut:</span>
                    <span class="font-medium text-primary-600">{{ commande.get_statut_display }}</span>
                </div>
                
                <div class="flex justify-between">
                    <span class="text-gray-600">Boutique:</span>
                    <span class="font-medium">{{ commande.commercant.nom_boutique }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery Address -->
    <div class="px-4 py-4">
        <div class="bg-white rounded-lg p-4">
            <h3 class="font-semibold text-gray-900 mb-3">Adresse de livraison</h3>
            <div class="flex items-start space-x-3">
                <i class="fas fa-map-marker-alt text-primary-600 mt-1"></i>
                <div>
                    <p class="text-gray-900">{{ commande.adresse_livraison }}</p>
                    {% if commande.instructions_livraison %}
                        <p class="text-sm text-gray-600 mt-1">
                            <strong>Instructions:</strong> {{ commande.instructions_livraison }}
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Order Items -->
    <div class="px-4 py-4">
        <div class="bg-white rounded-lg p-4">
            <h3 class="font-semibold text-gray-900 mb-4">Articles commandés</h3>
            
            <div class="space-y-3">
                {% for article in commande.articles.all %}
                <div class="flex items-center space-x-3">
                    {% if article.produit.photo %}
                        <img src="{{ article.produit.photo.url }}" 
                             alt="{{ article.produit.nom }}" 
                             class="w-12 h-12 object-cover rounded-lg">
                    {% else %}
                        <div class="w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center">
                            <i class="fas fa-box text-gray-400"></i>
                        </div>
                    {% endif %}
                    
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900">{{ article.produit.nom }}</h4>
                        <p class="text-sm text-gray-600">{{ article.quantite }} × {{ article.prix_unitaire|format_currency }}</p>
                    </div>
                    
                    <span class="font-semibold text-gray-900">{{ article.sous_total|format_currency }}</span>
                </div>
                {% endfor %}
            </div>
            
            <div class="border-t mt-4 pt-4">
                <div class="flex justify-between items-center">
                    <span class="text-lg font-bold text-gray-900">Total</span>
                    <span class="text-xl font-bold text-primary-600">{{ commande.total|format_currency }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Next Steps -->
    <div class="px-4 py-4">
        <div class="bg-white rounded-lg p-4">
            <h3 class="font-semibold text-gray-900 mb-3">Prochaines étapes</h3>
            
            <div class="space-y-2 text-sm text-gray-600">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-clock text-primary-600"></i>
                    <span>Votre commande sera préparée par le commerçant</span>
                </div>
                
                {% if commande.methode_paiement == 'espece' %}
                <div class="flex items-center space-x-2">
                    <i class="fas fa-money-bill-wave text-green-600"></i>
                    <span>Paiement en espèces à la livraison</span>
                </div>
                {% endif %}
                
                <div class="flex items-center space-x-2">
                    <i class="fas fa-truck text-blue-600"></i>
                    <span>Livraison à l'adresse indiquée</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons (Fixed Bottom) -->
<div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4">
    <div class="flex space-x-3">
        <a href="{% url 'clients:detail_commande' commande.id %}" 
           class="flex-1 py-3 border border-primary-600 text-primary-600 rounded-lg font-semibold text-center hover:bg-primary-50 transition-colors">
            Suivre ma commande
        </a>
        <a href="{% url 'clients:accueil' %}" 
           class="flex-1 py-3 bg-primary-600 text-gray-50 rounded-lg font-semibold text-center hover:bg-primary-700 transition-colors">
            Retour à l'accueil
        </a>
    </div>
</div>
{% endblock %}